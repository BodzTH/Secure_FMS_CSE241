# Security Information System - API Schema Documentation

## üîê Authentication Endpoints

### Base URL
```
http://localhost:3000/api/auth
```

---

## üìã Database Schema

### User Collection (MongoDB)
```javascript
{
  _id: ObjectId,
  firstName: String,      // Required, trimmed
  lastName: String,       // Required, trimmed
  email: String,          // Required, unique, lowercase, valid email format
  password: String,       // Required, hashed with bcrypt, min 8 characters
  role: String,           // Enum: ['user', 'admin'], default: 'user'
  loginAttempts: Number,  // Default: 0
  lastLoginAttempt: Date, // Default: null
  createdAt: Date,        // Auto-generated
  updatedAt: Date         // Auto-generated
}
```

---

## üåê API Endpoints

### 1. Register New User

**Endpoint:** `POST /api/auth/register`

**Request Body:**
```json
{
  "firstName": "John",
  "lastName": "Doe",
  "email": "john.doe@example.com",
  "password": "SecurePass123"
}
```

**Validation Rules:**
- ‚úÖ All fields are **required**
- ‚úÖ `firstName` and `lastName`: Cannot be empty, will be trimmed
- ‚úÖ `email`: Must be valid email format, will be converted to lowercase
- ‚úÖ `password`: **Minimum 8 characters**

**Success Response (201 Created):**
```json
{
  "message": "User registered successfully",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "507f1f77bcf86cd799439011",
    "firstName": "John",
    "lastName": "Doe",
    "email": "john.doe@example.com",
    "role": "user"
  }
}
```

**Error Responses:**
```json
// 400 - Missing fields
{
  "error": "All fields are required",
  "required": ["firstName", "lastName", "email", "password"]
}

// 400 - Password too short
{
  "error": "Password must be at least 8 characters"
}

// 409 - Email already exists
{
  "error": "Email already registered"
}
```

---

### 2. Login User

**Endpoint:** `POST /api/auth/login`

**Request Body:**
```json
{
  "email": "john.doe@example.com",
  "password": "SecurePass123"
}
```

**Validation Rules:**
- ‚úÖ Both `email` and `password` are **required**

**Success Response (200 OK):**
```json
{
  "message": "Login successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "507f1f77bcf86cd799439011",
    "firstName": "John",
    "lastName": "Doe",
    "email": "john.doe@example.com",
    "role": "user"
  }
}
```

**Error Responses:**
```json
// 400 - Missing fields
{
  "error": "Email and password are required"
}

// 401 - Invalid credentials
{
  "error": "Invalid email or password",
  "attemptsRemaining": 3
}

// 429 - Too many attempts (5 failed attempts)
{
  "error": "Too many login attempts",
  "message": "Account locked. Try again in 14 minutes."
}
```

**Security Features:**
- üîí **Login Attempt Limiting**: 5 failed attempts = 15 minutes lockout
- üîí **Password Hashing**: bcrypt with salt rounds = 10
- üîí **JWT Token**: Expires in 24 hours

---

## üîë JWT Token Structure

**Token Payload:**
```json
{
  "userId": "507f1f77bcf86cd799439011",
  "email": "john.doe@example.com",
  "firstName": "John",
  "lastName": "Doe",
  "iat": 1640995200,
  "exp": 1641081600
}
```

**Token Usage:**
Include the token in the `Authorization` header for protected routes:
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

---

## üõ°Ô∏è Authentication Middleware

**Usage Example (For Person 2 & 3):**
```javascript
const authMiddleware = require('./middleware/authMiddleware');

// Protected route
router.post('/upload', authMiddleware, uploadController.uploadFile);
```

**How it works:**
1. Extracts JWT token from `Authorization: Bearer <token>` header
2. Verifies token signature and expiration
3. Attaches decoded user data to `req.user`
4. Allows request to proceed to next middleware/controller

**Access user data in protected routes:**
```javascript
exports.protectedFunction = (req, res) => {
  const { userId, email, firstName, lastName } = req.user;
  // ... your logic
};
```

---

## üìä Input Fields Summary for Frontend

### Registration Form Inputs:
| Field       | Type   | Required | Validation              |
|-------------|--------|----------|-------------------------|
| firstName   | String | ‚úÖ       | Non-empty, trimmed      |
| lastName    | String | ‚úÖ       | Non-empty, trimmed      |
| email       | String | ‚úÖ       | Valid email format      |
| password    | String | ‚úÖ       | Min 8 characters        |

### Login Form Inputs:
| Field       | Type   | Required | Validation              |
|-------------|--------|----------|-------------------------|
| email       | String | ‚úÖ       | Valid email format      |
| password    | String | ‚úÖ       | Any length              |

---

## üß™ Test with Thunder Client / Postman

### Register:
```
POST http://localhost:3000/api/auth/register
Content-Type: application/json

{
  "firstName": "Ahmed",
  "lastName": "Mohamed",
  "email": "ahmed@example.com",
  "password": "12345678"
}
```

### Login:
```
POST http://localhost:3000/api/auth/login
Content-Type: application/json

{
  "email": "ahmed@example.com",
  "password": "12345678"
}
```

### Test Protected Route (Example):
```
GET http://localhost:3000/api/protected-endpoint
Authorization: Bearer YOUR_JWT_TOKEN_HERE
```

---

## üîê Security Features Summary

‚úÖ **Bcrypt Password Hashing** (10 salt rounds, automatic via Mongoose middleware)  
‚úÖ **JWT Token Authentication** (24-hour expiration)  
‚úÖ **Login Attempt Limiting** (5 attempts, 15-minute lockout)  
‚úÖ **Email Uniqueness** (MongoDB unique index)  
‚úÖ **Input Validation** (Required fields, minimum password length)  
‚úÖ **Secure Token Verification Middleware** (Ready for Person 2 & 3)

---

## üì¶ File Encryption Utility (For Person 2 & 3)

Located in `utils/fileCrypto.js`:
```javascript
const { encryptBuffer, decryptBuffer } = require('../utils/fileCrypto');

// Encrypt before saving
const encryptedData = encryptBuffer(fileBuffer);

// Decrypt before downloading
const originalData = decryptBuffer(encryptedData);
```
